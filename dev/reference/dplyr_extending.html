<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extending dplyr with new data frame subclasses — dplyr_extending • dplyr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../.css" rel="stylesheet">



<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Extending dplyr with new data frame subclasses — dplyr_extending" />
<meta property="og:description" content="
These three functions, along with names&amp;lt;- and 1d numeric [
(i.e. x[loc]) methods, provide a minimal interface for extending dplyr
to work with new data frame subclasses. This means that for simple cases
you should only need to provide a couple of methods, rather than a method
for every dplyr verb.
These functions are a stop-gap measure until we figure out how to solve
the problem more generally, but it's likely that any code you write to
implement them will find a home in what comes next." />
<meta property="og:image" content="https://dplyr.tidyverse.org/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">dplyr</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.0.7.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/dplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/grouping.html">Grouped data</a>
    </li>
    <li>
      <a href="../articles/two-table.html">Two-table verbs</a>
    </li>
    <li>
      <a href="../articles/base.html">dplyr &lt;-&gt; base R</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Automation</li>
    <li>
      <a href="../articles/colwise.html">Column-wise operations</a>
    </li>
    <li>
      <a href="../articles/rowwise.html">Row-wise operations</a>
    </li>
    <li>
      <a href="../articles/programming.html">Programming with dplyr</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../articles/index.html">More articles...</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Releases</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">Version 1.0.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/07/dplyr-0-8-3/">Version 0.8.3</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/06/dplyr-0-8-2/">Version 0.8.2</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/05/dplyr-0-8-1/">Version 0.8.1</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/02/dplyr-0-8-0/">Version 0.8.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/06/dplyr-0.7.5/">Version 0.7.5</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/dplyr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extending dplyr with new data frame subclasses</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidyverse/dplyr/blob/master/R/generics.R'><code>R/generics.R</code></a></small>
    <div class="hidden name"><code>dplyr_extending.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><a href='https://lifecycle.r-lib.org/articles/stages.html#experimental'><img src='figures/lifecycle-experimental.svg' alt='[Experimental]' /></a></p>
<p>These three functions, along with <code>names&lt;-</code> and 1d numeric <code>[</code>
(i.e. <code>x[loc]</code>) methods, provide a minimal interface for extending dplyr
to work with new data frame subclasses. This means that for simple cases
you should only need to provide a couple of methods, rather than a method
for every dplyr verb.</p>
<p>These functions are a stop-gap measure until we figure out how to solve
the problem more generally, but it's likely that any code you write to
implement them will find a home in what comes next.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>dplyr_row_slice</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>i</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>dplyr_col_modify</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>cols</span><span class='op'>)</span>

<span class='fu'>dplyr_reconstruct</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>template</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A tibble. We use tibbles because they avoid some inconsistent
subset-assignment use cases</p></td>
    </tr>
    <tr>
      <th>i</th>
      <td><p>A numeric or logical vector that indexes the rows of <code>.data</code>.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>A named list used modify columns. A <code>NULL</code> value should remove
an existing column.</p></td>
    </tr>
    <tr>
      <th>template</th>
      <td><p>Template to use for restoring attributes</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="basic-advice"><a class="anchor" href="#basic-advice"></a>Basic advice</h2>

    <p>This section gives you basic advice if you want to extend dplyr to work with
your custom data frame subclass, and you want the dplyr methods to behave
in basically the same way.</p><ul>
<li><p>If you have data frame attributes that don't depend on the rows or columns
(and should unconditionally be preserved), you don't need to do anything.</p></li>
<li><p>If you have <strong>scalar</strong> attributes that depend on <strong>rows</strong>, implement a
<code>dplyr_reconstruct()</code> method. Your method should recompute the attribute
depending on rows now present.</p></li>
<li><p>If you have <strong>scalar</strong> attributes that depend on <strong>columns</strong>, implement a
<code>dplyr_reconstruct()</code> method and a 1d <code>[</code> method. For example, if your
class requires that certain columns be present, your method should return
a data.frame or tibble when those columns are removed.</p></li>
<li><p>If your attributes are <strong>vectorised</strong> over <strong>rows</strong>, implement a
<code>dplyr_row_slice()</code> method. This gives you access to <code>i</code> so you can
modify the row attribute accordingly. You'll also need to think carefully
about how to recompute the attribute in <code>dplyr_reconstruct()</code>, and
you will need to carefully verify the behaviour of each verb, and provide
additional methods as needed.</p></li>
<li><p>If your attributes that are <strong>vectorised</strong> over <strong>columns</strong>, implement
<code>dplyr_col_modify()</code>, 1d <code>[</code>, and <code>names&lt;-</code> methods. All of these methods
know which columns are being modified, so you can update the column
attribute according. You'll also need to think carefully about how to
recompute the attribute in <code>dplyr_reconstruct()</code>, and you will need to
carefully verify the behaviour of each verb, and provide additional
methods as needed.</p></li>
</ul>

    <h2 class="hasAnchor" id="current-usage"><a class="anchor" href="#current-usage"></a>Current usage</h2>

    
<ul>
<li><p><code><a href='arrange.html'>arrange()</a></code>, <code><a href='filter.html'>filter()</a></code>, <code><a href='slice.html'>slice()</a></code>, <code><a href='filter-joins.html'>semi_join()</a></code>, and <code><a href='filter-joins.html'>anti_join()</a></code>
work by generating a vector of row indices, and then subsetting
with <code>dplyr_row_slice()</code>.</p></li>
<li><p><code><a href='mutate.html'>mutate()</a></code> generates a list of new column value (using <code>NULL</code> to indicate
when columns should be deleted), then passes that to <code>dplyr_col_modify()</code>.
<code><a href='mutate.html'>transmute()</a></code> does the same then uses 1d <code>[</code> to select the columns.</p></li>
<li><p><code><a href='summarise.html'>summarise()</a></code> works similarly to <code><a href='mutate.html'>mutate()</a></code> but the data modified by
<code>dplyr_col_modify()</code> comes from <code><a href='group_data.html'>group_data()</a></code>.</p></li>
<li><p><code><a href='select.html'>select()</a></code> uses 1d <code>[</code> to select columns, then <code>names&lt;-</code> to rename them.
<code><a href='rename.html'>rename()</a></code> just uses <code>names&lt;-</code>. <code><a href='relocate.html'>relocate()</a></code> just uses 1d <code>[</code>.</p></li>
<li><p><code><a href='mutate-joins.html'>inner_join()</a></code>, <code><a href='mutate-joins.html'>left_join()</a></code>, <code><a href='mutate-joins.html'>right_join()</a></code>, and <code><a href='mutate-joins.html'>full_join()</a></code>
coerces <code>x</code> to a tibble, modify the rows, then uses <code>dplyr_reconstruct()</code>
to convert back to the same type as <code>x</code>.</p></li>
<li><p><code><a href='nest_join.html'>nest_join()</a></code> uses <code>dplyr_col_modify()</code> to cast the key variables to
common type and add the nested-df that <code>y</code> becomes.</p></li>
<li><p><code><a href='distinct.html'>distinct()</a></code> does a <code><a href='mutate.html'>mutate()</a></code> if any expressions are present, then
uses 1d <code>[</code> to select variables to keep, then <code>dplyr_row_slice()</code> to
select distinct rows.</p></li>
</ul>

<p>Note that <code><a href='group_by.html'>group_by()</a></code> and <code><a href='group_by.html'>ungroup()</a></code> don't use any these generics and
you'll need to provide methods directly.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>dplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Romain François, Lionel Henry, <a href='https://krlmlr.info'>Kirill Müller</a>, <a href='https://www.rstudio.com'><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '1270c4079b26a138795263974bbf302d',
    indexName: 'tidyverse',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  

  </body>
</html>


